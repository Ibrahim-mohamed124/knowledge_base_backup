<!--
title: Air
description: 
published: true
date: 2025-11-13T11:35:43.070Z
tags: 
editor: ckeditor
dateCreated: 2025-11-12T19:18:53.202Z
-->

<h1>Backup Concepts</h1>
<h2><strong>Portworx Backup components</strong></h2>
<figure class="image"><img src="/pxb-arch.png"></figure>
<ul>
  <li>Portworx Backup server<ul>
      <li>Built on the Google Remote Procedure Call <mark class="marker-yellow">(gRPC</mark>) framework and offers performance benefits by reducing latency, increasing the performance of CRUD operations</li>
      <li>The server implements the basic <mark class="marker-yellow">CRUD operations on the Portworx Backup objects </mark>to handle the operations of data protection.<ul>
          <li>Backup</li>
          <li>Backup location</li>
          <li>Backup schedule</li>
          <li>Cloud credentials</li>
          <li>Cluster</li>
          <li>Restore</li>
          <li>Roles</li>
          <li>Rules</li>
          <li>Schedule policies</li>
        </ul>
      </li>
      <li>Portworx Backup Server <mark class="marker-yellow">communicates with Stork to create application-level backups</mark> by creating the <mark class="marker-yellow">backup location and application backups CRDs and Stork monitors these CRDs on each user’s cluster.</mark></li>
      <li>. Portworx Backup Server also monitors the status of application backups and application restores on these clusters.</li>
    </ul>
  </li>
</ul>
<blockquote>
  <h3>What gRPC Does</h3>
  <p><strong>Remote Procedure Calls</strong>: It lets a client call functions on a server as if they were local, even if the server is on another machine.</p>
  <p><strong>Cross-language support</strong>: Works with many languages like Python, Go, Java, C++, and more.</p>
  <p><strong>Efficient communication</strong>: Uses <strong>Protocol Buffers (Protobuf)</strong>, a compact binary format that’s faster and smaller than JSON or XML.</p>
</blockquote>
<ul>
  <li>REST APIs<ul>
      <li>Portworx Backup offers two APIs, <mark class="marker-yellow">backup API and backend API</mark>.<ul>
          <li>Portworx Backup backend API to create, manage and assign roles to the user.</li>
          <li>Portworx Backup API to create, delete, schedule, and restore backups.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Portworx Central<ul>
      <li>Facilitate a quick installation with spec generator to deploy Portworx Backup onto the clusters.</li>
      <li><strong>Portworx Central on-premises</strong> is a graphical web console that allows you to monitor and manage your Portworx clusters.</li>
    </ul>
  </li>
  <li>Backup cluster<ul>
      <li>The target cluster do deploy applications</li>
    </ul>
  </li>
  <li>Application clusters<ul>
      <li>The source cluster for the applications</li>
    </ul>
  </li>
  <li>Stork<ul>
      <li>a cloud native storage operator runtime scheduler plugin.</li>
    </ul>
  </li>
  <li>Datastore<ul>
      <li>where the Portworx Backup stores objects related to the cluster such as backup location, schedule policies, backup, restore, and backup schedules</li>
      <li>MongoDB is the datastore from the 2.0.0 version to store the metadata about the cluster objects</li>
    </ul>
  </li>
  <li>Keycloak<ul>
      <li>To validate and authorize tokens that are used for the API calls.</li>
      <li>Keycloak component can be configured to add compatible external OIDC providers either during installation or post-installation.</li>
    </ul>
  </li>
  <li>Cloud storage<ul>
      <li>backup target to provide storage for the backups</li>
      <li>a cloud-based S3 compliant object store backup location or cloud-based NFS backup location in Portworx Backup</li>
      <li>Portworx Backup supports object lock for cloud-based S3 compliant object store backup locations to secure your critical data.</li>
    </ul>
  </li>
</ul>
<blockquote>
  <p>You can add cloud-based object store or<mark class="marker-yellow"> block store backup location</mark> in Portworx Backup and backup your data on those cloud-based targets.</p>
</blockquote>
<ul>
  <li>NFS server<ul>
      <li>Portworx Backup's Stork component communicates directly with NFS server through PVCs.</li>
    </ul>
  </li>
</ul>
<h2><strong>Stork</strong></h2>
<ul>
  <li>An intelligent storage orchestrator for Kubernetes and a cloud native storage operator runtime scheduler plugin.</li>
  <li>Stork can actively communicate with any type of storage driver and not just Portworx.</li>
</ul>
<blockquote>
  <p>Stork facilitates stateful workflows such as snapshots, clones, cloud backups, and migrations. Stork provides:</p>
  <ul>
    <li>Kubernetes native mechanism for executing these workflows and makes it aware of storage and scheduler.</li>
    <li>A storage provider-agnostic method for executing these workflows.</li>
  </ul>
</blockquote>
<h3><strong>Stork capabilities</strong></h3>
<ul>
  <li>Stork acts as an <mark class="marker-yellow">abstraction layer between the underlying storage provider and Portworx Backup</mark>. Stork enables Portworx Backup to perform the following tasks:<ul>
      <li>Trigger and execute backups and restores on the target cluster</li>
      <li>Push the Kubernetes resources to the configured object storage location</li>
      <li>Integrate with storage providers for taking snapshots and pushing snapshots to object storage</li>
    </ul>
  </li>
</ul>
<h2><strong>Backup Workflow</strong></h2>
<figure class="image"><img src="/backup-workflow.png"></figure>
<p>&nbsp;</p>
<ul>
  <li><strong>Application Backup CR</strong>: The <mark class="marker-yellow">central entity for application backup.</mark></li>
  <li><strong>Volume Backup Processing</strong>:<ul>
      <li><strong>VMware, Cinder, and NFS Volumes</strong>: Backed up using <mark class="marker-yellow">CSI snapshots,</mark> <mark class="marker-yellow">CSI+KDMP</mark>, or<mark class="marker-yellow"> Non-CSI methods.</mark></li>
      <li><strong>Cloud Volumes (AWS, GCP, Azure, IBM)</strong>: Supports cloud snapshots, CSI+KDMP, and generic backups via KDMP.</li>
      <li><strong>PX Volumes</strong>: Backed up via <mark class="marker-yellow">CloudSnap to S3 or NFS Object Stores.</mark></li>
    </ul>
  </li>
  <li><strong>Resource Backup Processing:</strong>
    <ul>
      <li>Uses Object Store SDK (Stork) for backing up Kubernetes resources</li>
      <li>NFS resource export handles NFS-backed resource backups</li>
    </ul>
  </li>
</ul>
<blockquote>
  <p><strong>KDMP (Kubernetes Data Management Platform)</strong> is the internal engine used by Portworx Backup to handle backup and restore operations for Kubernetes workloads, especially those with persistent volumes.</p>
  <ul>
    <li><strong>Manages file-system level backups</strong>: KDMP attaches the mount point of a PVC on the worker node and copies its contents to object storage.</li>
    <li><strong>Supports both stateless and stateful apps</strong>: Ensures consistent backups of Kubernetes resources and data.</li>
    <li><strong>Used for generic backups</strong>: KDMP is the default method when CSI snapshots aren’t available or applicable.</li>
  </ul>
</blockquote>
<h2><strong>Portworx cloud snapshots</strong></h2>
<ul>
  <li>Portworx <mark class="marker-yellow">compares block metadata, called extents,</mark> to determine the<mark class="marker-yellow"> difference between the local snapshot and the previously uploaded cloud snapshot, so portworx does not need to store previous snapshots for comparison.</mark></li>
  <li>Portworx must also upload this metadata to the cloud alongside the cloud snap data, resulting in slightly larger uploads.</li>
  <li>Workflow:<ol>
      <li>Takes a snapshot</li>
      <li>Downloads extent data for the previous snapshot from the cloud</li>
      <li><mark class="marker-yellow">Compares extents</mark>, scans for changed blocks or generations</li>
      <li>Uploads the changes and new snapshot metadata</li>
      <li>Deletes the local snapshot</li>
    </ol>
  </li>
</ul>
<figure class="image"><img src="/portworx-driver.png"></figure>
<p>&nbsp;</p>
<h3><strong>Native CSI snapshot (On-premises)</strong></h3>
<ul>
  <li>Portworx Backup utilizes the storage provider's CSI driver to create a local snapshot on the array.&nbsp;</li>
  <li>To trigger a native CSI snapshot backup, in the <strong>Create Backup</strong> window:<ul>
      <li>Disable <strong>Cross Cloud Backup/Restore</strong> toggle button</li>
      <li>Map your provisioner with volume snapshot class (VSC) if applicable</li>
      <li>Disable <strong>Offload to backup location</strong></li>
    </ul>
  </li>
</ul>
<figure class="image"><img src="/native-csi.png"></figure>
<p>&nbsp;</p>
<h3><strong>KDMP backup</strong></h3>
<ul>
  <li><strong>Ouncers only when the storage provider is other than portworx enterprise&nbsp;</strong>
    <ul>
      <li>If the storage provider<mark class="marker-yellow"> does not support</mark> CSI snapshots<ul>
          <li>When storage provider does not support snapshot mechanism with CSI driver. For some on-premises (for example, Flash Array) or on cloud storage providers without CSI snapshot support, direct KDMP backup gets triggered and you need to choose <strong>Cross Cloud Backup/Restore</strong> option in the <strong>Create Backup</strong> window during backup creation operation.</li>
        </ul>
      </li>
      <li>If the storage provider <mark class="marker-yellow">supports CSI snapshots</mark> and if you want to <mark class="marker-yellow">offload the backup to a backup location (S3 or NFS) along with the selection of volume snapshot class during creation of backup.</mark></li>
    </ul>
  </li>
  <li><strong>Cross-cloud and cross-region backups and restores with Portworx Backup.</strong></li>
  <li><strong>3-2-1 backups</strong></li>
</ul>
<blockquote>
  <p><strong>3 copies of your data</strong>: One primary and two backups.</p>
  <p><strong>2 different storage media</strong>: For example, internal disk + external drive or cloud + tape.</p>
  <p><strong>1 copy offsite</strong>: Stored in a different physical location (e.g., cloud, remote data center).</p>
</blockquote>
<h4><strong>CSI local snapshot with KDMP</strong></h4>
<ol>
  <li>Takes available snapshot storageclass information</li>
  <li>Creates a local snapshot using CSI driver</li>
  <li>Uses KDMP driver to attach the mount point of the PV on the worker node</li>
  <li>Copies the file system contents to object store (S3 or others) or NFS backup location</li>
</ol>
<p>&nbsp;</p>
<figure class="image"><img src="/kdmp-with-ls.png"></figure>
<p>&nbsp;</p>
<ul>
  <li>To trigger a CSI local snapshot with KDMP, in the <strong>Create backup</strong> window:<ol>
      <li>Disable <strong>Cross Cloud Ba</strong>
        <ol>
          <li><strong>ckup/Restore</strong> toggle button</li>
          <li>Map your provisioner with volume snapshot class (vsc) wherever applicable</li>
          <li>Enable <strong>Offload to backup location</strong></li>
        </ol>
      </li>
    </ol>
  </li>
</ul>
<h4><strong>Direct KDMP/Generic</strong></h4>
<ul>
  <li>Portworx Backup triggers a direct KDMP backup in the following scenarios:<ul>
      <li>When you enable the <strong>Cross Cloud Backup/Restore</strong> option in the <strong>Create Backup</strong> window of the web console during back creation operation.</li>
    </ul>
  </li>
</ul>
<figure class="image"><img src="/direct-kdmp.png"></figure>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
