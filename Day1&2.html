<!--
title: Chapter 1.  Authentication and Identity Management
description: 
published: true
date: 2025-11-05T11:48:03.658Z
tags: 
editor: ckeditor
dateCreated: 2025-11-05T10:36:26.618Z
-->

<h1>Chapter&nbsp;1.&nbsp; Authentication and Identity Management</h1>
<ul>
  <li>Authentication could be via <mark class="marker-yellow">certificates or tokens</mark></li>
  <li>Kubernetes considers to be authenticated any user that presents<mark class="marker-yellow"> a valid certificate that is signed by a trusted certificate authority (CA).</mark> Kubernetes reads the <code>subject</code> field from the certificate, and assigns the username and the groups with the <code>common name</code> (CN) and the <code>organization</code> (O) fields, respectively.</li>
  <li>If the request does not present an access token or certificate, then Kubernetes assigns to the request the <code>system:anonymous</code> system user and the <code>system:unauthenticated</code> system group.</li>
  <li>Kubernetes uses RBAC policies to determine whether the anonymous user has appropriate access to perform the requested action.</li>
</ul>
<h2>Authentication in OpenShift</h2>
<ul>
  <li>OpenShift includes its own built-in OAuth server</li>
</ul>
<h3>Authentication Methods</h3>
<ul>
  <li>The OpenShift OAuth server handles user authentication, and it issues OAuth tokens that grant access to specific resources.</li>
</ul>
<ol>
  <li><strong>X.509 client certificates</strong></li>
  <li><strong>OAuth access tokens</strong>
    <ul>
      <li>OpenShift preconfigures Kubernetes to trust tokens that its own internal OAuth server issues.&nbsp;</li>
    </ul>
  </li>
</ol>
<h3>The OpenShift OAuth Server</h3>
<ul>
  <li>At OCP instillation the authentication operator is installed, which managed the lifecycle of the OAuth server</li>
  <li>The <mark class="marker-yellow">OpenShift OAuth server provides various identity providers (IdPs) that enable integration with identity management systems</mark> such as OpenID Connect and LDAP servers.</li>
</ul>
<figure class="image image_resized" style="width:100%;"><img src="/auth-firstlogin.svg"></figure>
<ul>
  <li>OpenShift web console stores the token in the browser memory instead of in a <code>kubeconfig</code> file</li>
  <li>The<mark class="marker-yellow"> two endpoints for login, which are the API server and the OAuth server,</mark> are the reason why you must accept two server certificates the first time that you log in to the OpenShift web console.</li>
  <li>OAuth user access tokens can be retrieved &nbsp;from the OpenShift OAuth server by using the <code><i>namespace_route</i>/oauth/authorize</code> and <code><i>namespace_route</i>/oauth/token</code> endpoints.</li>
</ul>
<h4>Configure the OpenShift OAuth Server</h4>
<ul>
  <li>After the user successfully logs in to the cluster, the OAuth server creates the<mark class="marker-yellow"> OAuth access token for the user</mark>, and <mark class="marker-yellow">OpenShift creates the identity and user resources.</mark></li>
</ul>
<pre><code class="language-plaintext">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders: 1
  - name: htpasswd-idp-name 2
    mappingMethod: claim 3
    type: HTPasswd
    htpasswd:
      fileData:
        name: htpasswd-secret 4
  - name: ldap-idp-name
    mappingMethod: claim
    type: LDAP
    ldap:
...output omitted...</code></pre>
<h3>Users, Groups, and Identities</h3>
<h4>System Groups</h4>
<ul>
  <li>predefined groups that are<mark class="marker-yellow"> built into the system</mark> to grant specific permissions and access rights to certain categories of users.<ul>
      <li><code><strong>system:authenticated</strong></code>
        <ul>
          <li>All authenticated users in the cluster, regardless of their role or namespace</li>
        </ul>
      </li>
      <li><code><strong>system:authenticated:oauth</strong></code>
        <ul>
          <li>All authenticated users with an OAuth access token in the cluster</li>
        </ul>
      </li>
      <li><code><strong>system:unauthenticated</strong></code>
        <ul>
          <li>Unauthenticated users, meaning those users who did not yet pass any authentication process</li>
        </ul>
      </li>
      <li><code><strong>system:masters</strong></code>
        <ul>
          <li>Users with administrative access to the cluster Members of this group have full control over all resources and actions within the cluster, including cluster-level operations and management.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>The<mark class="marker-yellow"> Kubernetes API server adds the strings from system groups to the user and group strings from the client certificate or from the token</mark>, whenever they apply. Then, Kubernetes uses RBAC rules to approve or deny the request depending on the user and groups.</li>
</ul>
<h4>User resource</h4>
<ul>
  <li>Defines regular users in the cluster</li>
</ul>
<pre><code class="language-plaintext">apiVersion: user.openshift.io/v1
kind: User
metadata:
  name: ibrahim
fullName: Ibrahim El Giza
identities:
  - myidp:ibrahim
groups:
  - dev-team
  - openshift-admins
</code></pre>
<ul>
  <li>The OpenShift internal OAuth server automatically creates user resources when users first log in to the cluster through an IdP.&nbsp;</li>
</ul>
<h4>Group resources&nbsp;</h4>
<ul>
  <li>Defines groups in the cluster.</li>
  <li>OpenShift supports users as members of one or more groups.</li>
  <li>OpenShift internal OAuth server automatically creates group resources when users first log in to the cluster through an OpenID Connect (OIDC) IdP.&nbsp;</li>
  <li>Other supported IdPs should &nbsp;manually manage group resources in OpenShift.</li>
</ul>
<pre><code class="language-plaintext">apiVersion: user.openshift.io/v1
kind: Group
metadata:
  name: dev-team
users:
  - ibrahim
  - fatma
  - ahmed
</code></pre>
<h4>Identity resource</h4>
<ul>
  <li>The identity resource keeps a record of successful authentication attempts from a specific <mark class="marker-yellow">user and IdP.</mark></li>
  <li>OpenShift maps external user identities from IdPs to user resources.</li>
</ul>
<pre><code class="language-plaintext">apiVersion: user.openshift.io/v1
kind: Identity
metadata:
  name: myidp:ibrahim
providerName: myidp
providerUserName: ibrahim
user:
  name: ibrahim
  uid: 12345678-90ab-cdef-1234-567890abcdef
</code></pre>
<h3>OAuth Server Mapping Methods</h3>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
